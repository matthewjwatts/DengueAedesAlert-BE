1.	Real time function (for 2024)
  a.	Mosquito information (colouring a postal code):
    i.	2024 â€“ information on a cumulative basis over 2024
    ii.	Scenarios 2 need to be marked: these are for 2024: Lebbeke, Puurs-Sint-Amands, Wilrijk and Kessel-Lo
  b.	Imported dengue case information (coloured stars):
    i.	Cases of the last week: with the mark of a red star (for example)
    ii.	Cases per month of 2024: to work with a different colour per month and with different size depending on number of cases for that month in that postal code
  c.	Overlap : alert function when a case in the current week is detected in a postal code where the mosquito was detected in 2024




```{r}

#install.packages("dplyr")
#install.packages("leaflet") 

library(dplyr)
library(leaflet)

# Convert 'Detection_date' to Date format if it's not already
aedes_data <- aedes_data %>%
  mutate(Detection_date = as.Date(Detection_date, format = "%Y-%m-%d")) # Adjust the format as needed

# Assuming 'Detection_date' is in Date format
#current_year <- format(Sys.Date(), "%Y")
current_year <- 2023

# Filter the data for the current year
aedes_data_filtered <- aedes_data %>%
  filter(format(Detection_date, "%Y") == current_year)


```


```{r}

# Convert 'Report_date' to Date format if it's not already
dengue_data <- dengue_data %>%
  mutate(Report_date = as.Date(Report_date, format = "%Y-%m-%d"))  # Adjust the format if necessary

```


```{r}

# Get the current date
current_date <- '2023-08-28'
current_date <- as.Date(current_date, format = "%Y-%m-%d")  # Removed the extra closing parenthesis

# Calculate the date 7 days before the current date
start_date <- current_date - 96

# Filter the data to include only the last 7 days
dengue_data_filtered <- dengue_data %>%
  filter(Report_date >= start_date & Report_date <= current_date)


```



```{r}



```



```{r}


######################################################################################
# Identification of overlaps 2023: Dengue infections and 2023 Aedes 2023 detections
#######################################################################################

# Counting observations per year
yearly_postcode_dengue_counts <- DENV_Belgium %>%
  group_by(dengue_year, Postcode) %>%
  summarise(count = n()) %>%
  ungroup()

# first select year of dengue introduction
# Next query this against the aedes data set, it should only select the current years and up to 4 years before. results should be displayed in a map and table. 


# Define the target year
target_year <- 2023


yearly_postcode_dengue_counts$dengue_year <- as.numeric(yearly_postcode_dengue_counts$dengue_year)


denv_aedes_matches <- yearly_postcode_dengue_counts %>%
  filter(dengue_year == target_year) %>%
  inner_join(long_aedes_data, by = c("Postcode" = "Postcode", "dengue_year" = "year")) %>%
  filter(detection == 1)  
  

# note needs to be alert if cases not matched
denv_aedes_matched_cases_shp <- dplyr::right_join(belgium_shp, denv_aedes_matches, by = "Postcode") 
  


# Load necessary libraries
library(sf)
library(leaflet)

# Read your data into an SF object
# Replace 'your_data_file' with your actual data file path
# Example assuming your data is in a shapefile




# Create the bins
denv_aedes_matched_cases_shp$bins <- cut(denv_aedes_matched_cases_shp$count, breaks = c(0, 2,  5, 10, 20, 30, 50, Inf), 
                        labels = c("1-2", "3-5", "6-10", "11-20", "21-30", "31-50", ">50"), right = FALSE)

# Create a color palette based on the bins
pal <- colorFactor(palette = "YlOrRd", domain = denv_aedes_matched_cases_shp$bins)

# Create the leaflet map
map <- leaflet(denv_aedes_matched_cases_shp) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(
    fillColor = ~pal(bins),
    fillOpacity = 0.7,
    color = "#BDBDC3",
    weight = 1,
    popup = ~paste("Municipality: ", namedut,  "; Post Code:", Postcode,  "; Dengue Cases 2013:", count)
  ) %>%
  addLegend(
    pal = pal,
    values = ~bins,
    opacity = 0.7,
    title = "Dengue Cases",
    position = "bottomright"
  )

# Print the map
map




```

